layui.use(["form","layer","jquery","cookie","element"],function(){function f(i){n.ajax({url:"/UserInfo/AddCollectArticle",type:"post",async:!0,dataType:"json",data:{articleid:i.split(",")[0]},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(i){i.code==200&&n(".collectarticle").children("i").addClass("icon-favorite-o");t.msg(i.msg)},error:function(){}})}function e(i){n.ajax({url:"/UserInfo/AddAttentionObjects",type:"post",async:!0,dataType:"json",data:{objectid:i.split(",")[0],objecttype:"Journal",lastNum:i.split(",")[1]},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(i){i.code==200&&n(".attentionobjects").children("i").addClass("icon-favorite-o");t.msg(i.msg)},error:function(){}})}var i=layui.form,t=layui.layer,n=layui.jquery,o=layui.cookie,u=layui.element,r;window.S4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};window.createGuid=function(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()};window.addSelectArticleSession=function(r){var s="",e=[],f,o,u;if(r!=""){if(f=[],f=r.split(","),s=getSessionSelectArticle(),s=="")for(u=0;u<f.length;u++)e.push(f[u].toString());else{for(o=[],o=s.split(","),u=0;u<o.length;u++)e.push(o[u].toString());for(u=0;u<f.length;u++)n.inArray(f[u].toString(),o)<0&&e.push(f[u].toString())}if(e.length>500){for(t.msg("最多只能选择500条！"),u=0;u<f.length;u++)n("#articlelist").find("input[type=checkbox]").each(function(){var t=n(this).data("id");n.inArray(t.toString(),f)>=0&&n(this).prop("checked",!1)});n("input[name=selectArticleAll]").prop("checked",!1);i.render();return}setSessionSelectArticle(e.join(","))}};window.delSelectArticleSession=function(t){var u="",f,i,e,r;if(t!=""&&(f=[],f=t.split(","),u=getSessionSelectArticle(),u!="")){for(i=[],e=[],i=u.split(","),r=0;r<i.length;r++)n.inArray(i[r].toString(),f)<0&&e.push(i[r].toString());setSessionSelectArticle(e.join(","))}};i.on("submit(btn-search)",function(i){var r,u,f,e;if(1){if(n("#hid_searchtype").val("search"),r=checkUserOperate(),setCookie("search_isEnable",r),r==0){n("#valiCode").attr("src","/RegistLogin/AuthCode?key=requestLimit&time="+(new Date).getTime());t.open({type:1,closeBtn:0,title:"检索验证",area:["600px","300px"],content:n("#checkcode"),shadeClose:!0,success:function(){n("#txtPdfTitle").val("");n("#txtPdfTitle").focus()}});return}n(this).parent().addClass("searching");u="";i.field.searchKeywords!=""&&(u=i.field.identifier+"="+i.field.searchKeywords);f=1;e=1;n.StandardPost("/Qikan/Search/Index",{key:encodeURIComponent(u),isNoteHistory:f,isLog:e,indexKey:i.field.searchKeywords,indexIdentifier:i.field.identifier})}else loginAction()});window.bindAutoComplete=function(){n("#searchKeywords").AutoComplete({data:"/Qikan/Search/AutoComplate",timeout:3e3,ajaxParams:function(){return{objType:"articles".toLowerCase(),keyword:encodeURIComponent(n("input[name='searchKeywords']").val())}},ajaxDataType:"json",width:"auto",itemHeight:25,leftOffset:-6,maxItems:30,maxHeight:232,beforeLoadDataHandler:function(t){return t.length>=2?(n(".ac").show(),!0):(n(".ac").hide(),!1)},onerror:function(n){alert(n)},afterSelectedHandler:function(){var u,f;n("#btnSearch").parent().addClass("searching");var i="",r=n("select[name='identifier']").val(),t=n("input[name='searchKeywords']").val();t!=""&&(i=r+"="+t);u=1;f=1;n.StandardPost("/Qikan/Search/Index",{key:encodeURIComponent(i),isNoteHistory:u,isLog:f,indexKey:t,indexIdentifier:r})}})};bindAutoComplete();i.on("checkbox(selectArticleAll)",function(){var f,r,e;var t=[],u=[],o=n("#searchType").val();o=="advance"?(f="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return f=n(this).data("guid"),!1}),r=n(this).prop("checked"),n("div[data-guid="+f+"]").find("input[name=selectArticleAll]").each(function(){r?n(this).prop("checked",!0):n(this).prop("checked",!1)}),n("div[data-guid="+f+"]").find("div[id=articlelist]").find("input[type=checkbox]").each(function(){var i=n(this).data("id");r?(n(this).prop("checked",!0),n.inArray(i.toString(),t)<0&&t.push(i.toString())):(n(this).prop("checked",!1),n.inArray(i.toString(),u)<0&&u.push(i.toString()))}),n("div[data-guid="+f+"]").siblings().find("div[id=articlelist]").find("input[type=checkbox]").each(function(){var i=n(this).data("id");n.inArray(i.toString(),t)>=0?n(this).prop("checked",!0):n(this).prop("checked",!1)})):(r=n(this).prop("checked"),n("input[name=selectArticleAll]").each(function(){r?n(this).prop("checked",!0):n(this).prop("checked",!1)}),n("#articlelist").find("input[type=checkbox]").each(function(){var i=n(this).data("id");r?(n(this).prop("checked",!0),n.inArray(i.toString(),t)<0&&t.push(i.toString())):(n(this).prop("checked",!1),n.inArray(i.toString(),u)<0&&u.push(i.toString()))}));addSelectArticleSession(t.join(","));delSelectArticleSession(u.join(","));e=getSelectArticleCount();n('span[data-topcount="topcount"]').text(e);n('span[data-footcount="footcount"]').text(e);n('sub[data-topcount="topcount"]').text(e);n("#selectArticleCount").text(e);i.render()});window.getSelectArticleCount=function(){var n=0,t=getSessionSelectArticle();return t!=""&&(n=t.split(",").length),n};n(document).on("click","#clearSelectArticle",function(){var r=n(this);t.open({content:"确认要清空已选文章吗?",title:"提示",icon:3,btn:["确定","取消"],shadeClose:!0,yes:function(){setSessionSelectArticle("");n(".selection-list dl").each(function(){n("input[data-id="+n(this).data("id")+"]").each(function(){n(this).prop("checked",!1)});n(this).remove()});n("#articlelist").find("input[type=checkbox]").each(function(){n(this).prop("checked",!1)});n("input[name=selectArticleAll]").prop("checked",!1);i.render("checkbox");var r=getSelectArticleCount();n('span[data-topcount="topcount"]').text(r);n('sub[data-topcount="topcount"]').text(r);n('span[data-footcount="footcount"]').text(r);n("#selectArticleCount").text(r);t.closeAll()},btn2:function(n){t.close(n)},zIndex:t.zIndex,success:function(n){t.setTop(n)}})});i.on("checkbox(selectArticle)",function(){var t=n(this).data("id"),u=n(this).prop("checked"),f=[],e=[],r,o;n("input[data-id="+t+"]").each(function(){u?(n(this).prop("checked",!0),n.inArray(t.toString(),f)<0&&f.push(t.toString())):(n(this).prop("checked",!1),n.inArray(t.toString(),e)<0&&e.push(t.toString()))});addSelectArticleSession(f.join(","));delSelectArticleSession(e.join(","));r=getSelectArticleCount();n('span[data-topcount="topcount"]').text(r);n('span[data-footcount="footcount"]').text(r);n('sub[data-topcount="topcount"]').text(r);n("#selectArticleCount").text(r);u?(o=!0,n("#articlelist").find("input[type=checkbox]").each(function(){return u=n(this).prop("checked"),u?void 0:(o=!1,!1)}),o&&n("input[name=selectArticleAll]").prop("checked",!0)):n("input[name=selectArticleAll]").prop("checked",!1);i.render()});window.checkIsChecked=function(){var u,f,r,t;if(n.ajax({type:"post",url:"/WebControl/CheckIsOrg",dataType:"json",async:!1,success:function(t){var i=t.RetValue;i==0?(n(".search-tools").show(),n(".behavior-allDowns").show()):n(".behavior-exporttitle").show()}}),u=getSessionSelectArticle(),u!="")for(f=u.split(","),r=0;r<f.length;r++)n("input[data-id="+f[r]+"]").each(function(){n(this).prop("checked",!0);i.render("checkbox")});t=getSelectArticleCount();n('span[data-topcount="topcount"]').text(t);n('span[data-footcount="footcount"]').text(t);n('sub[data-topcount="topcount"]').text(t);n("#selectArticleCount").text(t);i.render()};window.search=function(i){var r,u;if(n("div[data-container=leftCluster]").html(""),n(".leftcluser-loading").show(),r=JSON.stringify(i),n("#hidRequestsearchParamModel").val(r),n("#hid_searchtype").val("searchList"),u=checkUserOperate(),setCookie("search_isEnable",u),u==0){n("#valiCode").attr("src","/RegistLogin/AuthCode?key=requestLimit&time="+(new Date).getTime());t.open({type:1,closeBtn:0,title:"检索验证",area:["600px","300px"],content:n("#checkcode"),shadeClose:!0,success:function(){n("#txtPdfTitle").val("");n("#txtPdfTitle").focus()}});return}searchList(r)};window.searchList=function(t){n.ajax({url:"/Search/SearchList",type:"post",dataType:"html",data:{searchParamModel:t},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(t){n("#searchlist").html(t);checkIsChecked();n("html,body").animate({scrollTop:0},0);i.render();u.render()},error:function(){loaddingClose()}})};window.advSearch=function(t,r){t.AdvTabGuid=r;n("div[data-guid="+r+"]").find("div[data-container=leftCluster]").html("");n("div[data-guid="+r+"]").find(".leftcluser-loading").show();n.ajax({url:"/Search/SearchList",type:"post",dataType:"html",data:{searchParamModel:JSON.stringify(t)},beforeSend:function(){loadding()},complete:function(){},success:function(f){var e,o;n("#body >.l-width> .search-list").html(f);e=n("#body >.l-width> .search-list").find("input[name=preSearchParamModelJson]").val();e!=""&&(t=JSON.parse(e));n("#body >.l-width> .search-list").append('<input type="hidden" name="searchParamModelJson" value=\''+e+" ' />");o=n("div[data-guid="+r+"]");o.length>0?o.html(n("#body >.l-width> .search-list").html()):(n("#location>ul").append('<li data-guid="'+r+'"><a class="sel-close" href="javascript:void(0)"><i class="icon-close"><\/i><\/a><a href="javascript:void(0)" title="'+t.AdvShowTitle.replace(/\"/g,"")+'">'+t.AdvShowTitle.replace(/\"/g,"")+"<\/a><\/li>"),n("#location>ul").children("li:last-child").addClass("tab-this").prevAll().removeClass("tab-this"),addTabDiv(r));checkTabShowStatus();checkIsChecked();gotoLocation();i.render();u.render();loaddingClose()},error:function(){loaddingClose()}})};window.checkTabShowStatus=function(){for(var t=0;t<n("#location li").length;t++)n("#location li").length-5>t?n("#location li").eq(t).hide():n("#location li").eq(t).show()};window.gotoLocation=function(){n("html,body").animate({scrollTop:n(".advance").scrollTop()+n("#location").offset().top-n(".advance").offset().top-50},0)};n("#location>ul").on("click","li>a>i",function(t){layui.stope(t);var r=n(this).parent().parent(),i=r.data("guid");n("li[data-guid="+i+"]").next().length>0?r.hasClass("tab-this")&&(n("li[data-guid="+i+"]").next().addClass("tab-this"),n("li[data-guid="+i+"]").prevAll().removeClass("tab-this"),n("div[data-guid="+i+"]").next().show(),n("div[data-guid="+i+"]").prevAll().hide()):n("li[data-guid="+i+"]").prev().length>0&&r.hasClass("tab-this")&&(n("li[data-guid="+i+"]").prev().addClass("tab-this"),n("li[data-guid="+i+"]").prev().prevAll().removeClass("tab-this"),n("div[data-guid="+i+"]").prev().show(),n("div[data-guid="+i+"]").prev().prevAll().hide());n("li[data-guid="+i+"]").remove();n("div[data-guid="+i+"]").remove();checkTabShowStatus()});n(document).on("click","#location>ul>li",function(){n(this).addClass("tab-this").siblings().removeClass("tab-this");n("div[data-guid="+n(this).data("guid")+"]").show().siblings().hide();i.render()});n(document).on("click",".author .more.hide",function(){n(this).hide();n(this).siblings("span").show()});n(document).on("click",".fund .more.hide",function(){n(this).hide();n(this).siblings("span").show()});n(document).on("click",".list-op .articleRefence a",function(){t.closeAll();var r=n(this).data("stype"),i="";if(i=getSessionSelectArticle(),i==""){t.msg("请选择要查看的文献！");return}n.StandardPostNewWindow("/Qikan/Search/Index",{stype:r,strIds:i})});n(document).off("click","#articlelist .cited a,.article .cited a").on("click","#articlelist .cited a,.article .cited a",function(){n.StandardPostNewWindow("/Qikan/Search/Index",{stype:"by",strIds:n(this).data("articleid"),totalcount:n(this).data("zkbycount")})});n(document).on("click",".articleOperateDown a",function(){t.closeAll();var u=n(this).data("stype"),r="";if(r=getSessionSelectArticle(),r==""){t.msg("请选择要查看的文献！");return}u=="export"?n.StandardPostNewWindow("/Qikan/Search/Export",{ids:r,strType:"title_info"}):u=="allDown"&&n.ajax({type:"post",url:"/WebControl/CheckIsOrg",dataType:"json",async:!1,success:function(r){var u=r.RetValue;u==0?n.ajax({url:"/Qikan/WebControl/Batch",type:"post",dataType:"html",beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(r){n("#batch").html(r);i.render();t.open({type:1,skin:"layui-layer-rim",title:"批量处理 ",area:["950px","600px"],anim:0,resize:!1,content:n("#batch"),shadeClose:!0,zIndex:t.zIndex,success:function(n){t.setTop(n)}})},error:function(){}}):t.msg("请使用机构账号体验")}})});n(document).on("click",".selection-tool .articleRefence a",function(){var r=n(this).data("stype"),i="";if(i=getSessionSelectArticle(),i==""){t.msg("请选择要查看的文献！");return}n.StandardPostNewWindow("/Qikan/Search/Index",{stype:r,strIds:i})});n(document).on("click",".list-op  .articleReport a",function(){var i,o,f,s,e,h,r,u;if(t.closeAll(),i=getSearchParamModel(),o=n("#searchType").val(),o=="advance"&&(f="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return f=n(this).data("guid"),!1}),s=n("div[data-guid="+f+"]").find("input[name=searchParamModelJson]").val(),i=JSON.parse(s)),e="",h=n(this).data("stype"),h=="chose"){if(r="",r=getSessionSelectArticle(),r==""){t.msg("请选择要统计分析的文献！");return}e=r}else if(i.ShowRules==""){t.msg("请先进行检索！");return}u=n("<form><\/form>").attr("action","/Qikan/Search/ArticleReport?from="+GetCurrentPath()).attr("method","post").attr("target","_blank");u.append(n("<input><\/input>").attr("name","searchParamModel").attr("type","hidden").attr("value",JSON.stringify(i)));u.append(n("<input><\/input>").attr("name","choseId").attr("type","hidden").attr("value",e));u.appendTo("body").submit().remove()});n(document).on("click",".selection-tool .articleReport a",function(){var u=getSearchParamModel(),h=n("#searchType").val(),f,o,e,s,i,r;if(h=="advance"&&(f="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return f=n(this).data("guid"),!1}),o=n("div[data-guid="+f+"]").find("input[name=searchParamModelJson]").val(),u=JSON.parse(o)),e="",s=n(this).data("stype"),s=="chose"){if(i="",i=getSessionSelectArticle(),i==""){t.msg("请选择要统计分析的文献！");return}e=i}else if(u.ShowRules==""){t.msg("请先进行检索！");return}r=n("<form><\/form>").attr("action","/Qikan/Search/ArticleReport?from="+GetCurrentPath()).attr("method","post").attr("target","_blank");r.append(n("<input><\/input>").attr("name","searchParamModel").attr("type","hidden").attr("value",JSON.stringify(u)));r.append(n("<input><\/input>").attr("name","choseId").attr("type","hidden").attr("value",e));r.appendTo("body").submit().remove()});n(document).on("click",".input-group .layui-btn-group .layui-btn,.input-group .layui-btn-group .layui-btn",function(){if(n(this).data("type")=="plus")n(".advance-input .input-group").length<5&&n(".advance-input").append(n("div[name=template] .input-group").clone());else if(n(this).data("type")=="minus"&&n(".advance-input .input-group").length>3){var t=n(this).parent().parent().parent();t.remove()}i.render()});window.addTabDiv=function(t){n("#tabDiv").append(n("#body >.l-width> .search-list").clone());n("#tabDiv").children("div:last-child").attr("data-guid",t).show().prevAll().hide()};n(document).off("click","#basic_searchdomainfilter .advance-submit .adv-search").on("click","#basic_searchdomainfilter .advance-submit .adv-search",function(){var s,l,i,e,r,u,f,o,h,c,a;if(n("#hid_searchtype").val("RetrievalSearchExpression"),s=checkUserOperate(),setCookie("search_isEnable",s),s==0){n("#valiCode").attr("src","/RegistLogin/AuthCode?key=requestLimit&time="+(new Date).getTime());t.open({type:1,closeBtn:0,title:"检索验证",area:["600px","300px"],content:n("#checkcode"),shadeClose:!0,success:function(){n("#txtPdfTitle").val("");n("#txtPdfTitle").focus()}});return}for(l=n(".advance-input .input-group").length,i=new SearchParamModel,i.ObjectType=1,e="",r=0;r<l;r++)n("select[name='advIdentifier']").eq(r).val()!=""&&n("select[name='advIdentifier']").eq(r).val()!="undefined"&&n("input[name='advSearchKeywords']").eq(r).val()!=""&&n("select[name='advSearchKeywords']").eq(r).val()!="undefined"&&(u=new SearchKeyModel,r>0&&(u.PreLogicalOperator=n("select[name='logicalOperator']").eq(r-1).val(),e+=" "+u.PreLogicalOperator+" "),u.FieldIdentifier=n("select[name='advIdentifier']").eq(r).val(),e+=n("select[name='advIdentifier']").eq(r).find("option:selected").text(),e+="=",u.SearchKey=n("input[name='advSearchKeywords']").eq(r).val(),e+=u.SearchKey,u.IsExact=n("select[name='isExact']").eq(r).val(),u.SearchKey.trim()!=""&&i.SearchKeyList.push(u));if(i.AdvShowTitle=e,f=getSearchYearRange("basic_"),f=="false")return t.msg("开始时间不能大于结束时间！"),!1;if(f.indexOf("-")>=0)o=[],o=f.split("-"),i.BeginYear=o[0],i.EndYear=o[1],i.AdvShowTitle==""?i.AdvShowTitle="年份："+i.BeginYear+"-"+i.EndYear:i.AdvShowTitle+=" AND 年份："+i.BeginYear+"-"+i.EndYear,i.AdvShowTitle=i.AdvShowTitle.replace(/1900/g,"收录起始年");else if(f!=""){i.UpdateTimeType=f;i.AdvShowTitle!=""&&(i.AdvShowTitle+=" AND ");i.AdvShowTitle+="更新时间：";switch(f){case"1":i.AdvShowTitle+="一个月内";break;case"2":i.AdvShowTitle+="三个月内";break;case"3":i.AdvShowTitle+="半年内";break;case"4":i.AdvShowTitle+="一年内";break;case"5":i.AdvShowTitle+="当年内"}}h=getSearchJournalRange("basic_");h!=""&&(i.JournalRange=h,i.AdvShowTitle!=""&&(i.AdvShowTitle+=" AND "),i.AdvShowTitle+="期刊范围："+getSearchJournalRangeName("basic_"));c=getSearchDomainRange("basic_");c!=""&&(i.DomainRange=c,i.AdvShowTitle!=""&&(i.AdvShowTitle+=" AND "),i.AdvShowTitle+="学科限定："+getSearchDomainRangeName("basic_"));i.IsNoteHistory=1;n("input[name=basic_chn_en_extend]").prop("checked")&&(i.ChineseEnglishExtend=1);n("input[name=basic_synonym_extend]").prop("checked")&&(i.SynonymExtend=1);i.AdvShowTitle==""&&(i.AdvShowTitle="空检索");a=createGuid();advSearch(i,a)});n(document).off("click","#re_searchdomainfilter .advance-submit .adv-search").on("click","#re_searchdomainfilter .advance-submit .adv-search",function(){var f,h,i,r,u,e,o,s;if(n("#hid_searchtype").val("RetrievalBasicExpression"),f=checkUserOperate(),setCookie("search_isEnable",f),f==0){n("#valiCode").attr("src","/RegistLogin/AuthCode?key=requestLimit&time="+(new Date).getTime());t.open({type:1,closeBtn:0,title:"检索验证",area:["600px","300px"],content:n("#checkcode"),shadeClose:!0,success:function(){n("#txtPdfTitle").val("");n("#txtPdfTitle").focus()}});return}if(h=n(".advance-input .input-group").length,i=new SearchParamModel,i.ObjectType=1,i.SearchExpression=n(".layui-textarea").val(),i.SearchExpression.trim()=="")return t.msg("请输入检索条件！"),!1;if(i.AdvShowTitle=i.SearchExpression,r=getSearchYearRange("re_"),r=="false")return t.msg("开始时间不能大于结束时间！"),!1;if(r.indexOf("-")>=0)u=[],u=r.split("-"),i.BeginYear=u[0],i.EndYear=u[1],i.AdvShowTitle==""?i.AdvShowTitle="年份："+i.BeginYear+"-"+i.EndYear:i.AdvShowTitle+=" AND 年份："+i.BeginYear+"-"+i.EndYear,i.AdvShowTitle=i.AdvShowTitle.replace(/1900/g,"收录起始年");else if(r!=""){i.UpdateTimeType=r;i.AdvShowTitle!=""&&(i.AdvShowTitle+=" AND ");i.AdvShowTitle+="更新时间：";switch(r){case"1":i.AdvShowTitle+="一个月内";break;case"2":i.AdvShowTitle+="三个月内";break;case"3":i.AdvShowTitle+="半年内";break;case"4":i.AdvShowTitle+="一年内";break;case"5":i.AdvShowTitle+="当年内"}}e=getSearchJournalRange("re_");e!=""&&(i.JournalRange=e,i.AdvShowTitle!=""&&(i.AdvShowTitle+=" AND "),i.AdvShowTitle+="期刊范围："+getSearchJournalRangeName("re_"));o=getSearchDomainRange("re_");o!=""&&(i.DomainRange=o,i.AdvShowTitle!=""&&(i.AdvShowTitle+=" AND "),i.AdvShowTitle+="学科限定："+getSearchDomainRangeName("re_"));i.AdvShowTitle==""&&(i.AdvShowTitle="空检索");i.IsNoteHistory=1;s=createGuid();advSearch(i,s)});n(document).off("keyup","input[name=advSearchKeywords]").on("keyup","input[name=advSearchKeywords]",function(t){var i=window.event||t,r=i.keyCode||i.which;r==13&&n("#basic_searchdomainfilter .advance-submit .adv-search").click()});window.getSearchDomainRange=function(t){var i="";return n("#"+t+"checkboxAllXueKe").prop("checked")==!1&&(n("#"+t+"searchDomain>ul>li>span").each(function(){n(this).find("input:checkbox:checked").prop("checked")==!0&&(i+=i!=""?","+n(this).find("input:checkbox").val():n(this).find("input:checkbox").val())}),n("#"+t+"searchDomain>ul>li>ul>li>span").each(function(){n(this).find("input:checkbox:checked").prop("checked")==!0&&n(this).parent().parent().prev().find("input:checkbox").prop("checked")==!1&&(i+=i!=""?","+n(this).find("input:checkbox").val():n(this).find("input:checkbox").val())})),i};window.getSearchDomainRangeName=function(t){var i="";return n("#"+t+"checkboxAllXueKe").prop("checked")==!1&&(n("#"+t+"searchDomain>ul>li>span").each(function(){n(this).find("input:checkbox:checked").prop("checked")==!0&&(i+=i!=""?","+n(this).find("input:checkbox").attr("title"):n(this).find("input:checkbox").attr("title"))}),n("#"+t+"searchDomain>ul>li>ul>li>span").each(function(){n(this).find("input:checkbox:checked").prop("checked")==!0&&n(this).parent().parent().prev().find("input:checkbox").prop("checked")==!1&&(i+=i!=""?","+n(this).find("input:checkbox").attr("title"):n(this).find("input:checkbox").attr("title"))})),i};window.getSearchJournalRange=function(t){var i="";return n("input[name="+t+"journalRange]:checked").each(function(){n(this).val()!=1&&(i+=i!=""?","+n(this).val():n(this).val())}),i};window.getSearchJournalRangeName=function(t){var i="";return n("input[name="+t+"journalRange]:checked").each(function(){n(this).val()!=1&&(i+=i!=""?","+n(this).attr("title"):n(this).attr("title"))}),i};window.getSearchYearRange=function(t){var i="",s=n("input[name="+t+"yearRange]:checked").val(),r,u,e,o,f;if(s==1)if(r=n("select[name="+t+"beginYear]").val(),u=n("select[name="+t+"endYear]").val(),e=new Date,o=e.getFullYear(),r==1900&&u==o)i="";else{if(u<r)return"false";i=r+"-"+u}else f=n("select[name="+t+"updateTimeType]").val(),typeof f=="undefined"&&(f=1),i=f;return i};i.on("checkbox(journalRange)",function(r){var u=n(this).data("type");r.value==1&&n(this).prop("checked")?(n("input[name="+u+"journalRange]").each(function(){n(this).prop("checked",!1)}),n(this).prop("checked",!0)):r.value!=1||n(this).prop("checked")?r.value!=1&&n(this).prop("checked")&&n("input[name="+u+"journalRange]").each(function(){n(this).val()==1&&n(this).prop("checked",!1)}):(t.msg("总得选一个吧！"),n(this).prop("checked",!0));i.render("checkbox")});window.showRemark=function(t){n(t).parent().parent().find(".abstract").html(n(t).prev().html());n(t).hide()};window.showRemarkImprove=function(t){n(t).parent().parent().find(".abstract").html(n(".instand").html());n(t).parent().parent().parent().find(".abstract").html(n(".instand").html());n(t).hide()};i.on("checkbox(basic_domainRangeAll)",function(){initDomainChekBox();i.render()});i.on("checkbox(re_domainRangeAll)",function(){initDomainChekBox();i.render()});i.on("checkbox(domainRangeFirstLevel)",function(){n(this).prop("checked")?n(this).parent().next().find(":checkbox").each(function(){n(this).prop("checked",!0).attr("disabled",!0)}):n(this).parent().next().find(":checkbox").each(function(){n(this).prop("checked",!1).attr("disabled",!1)});i.render()});n(".cluster-item .icon-arrow-right").parent().on("click",function(t){var u=t.target.nodeName.toLowerCase(),r=n(this).parent();r.hasClass("show-more")?r.removeClass("show-more"):r.addClass("show-more");layui.stope(t);i.render()});n(document).on("click",".btn-switch .layui-btn",function(){var t=n(this),i=t.data("type");r[i]?r[i].call(this,t):""});r={set:function(t){var i=t.data("key"),f=getSearchParamModel(),e,r,u;switch(f.ObjectType){case 1:n.cookie("LIBUSERSETARTICLELISTTYPECOOKIE",i,{expires:1,path:"/"});break;case 7:n.cookie("LIBUSERSETJOURNALLISTTYPECOOKIE",i,{expires:1,path:"/"})}e={};r=n("#searchType").val();r=="normal"?(n(".search-result-list>div").each(function(){n(this).hide()}),n("#"+i).show(),t.addClass("active").siblings().removeClass("active")):r=="advance"&&(u="",t.parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return u=n(this).data("guid"),!1}),n("div[data-guid="+u+"] .search-main .search-result-list>div").each(function(){n(this).attr("id")==i?n(this).show():n(this).hide()}),t.addClass("active").siblings().removeClass("active"))},order:function(t){var r=t.data("key"),u=getSearchParamModel(),f;u.Sort=r;switch(u.ObjectType){case 1:n.cookie("LIBUSERSETARTICLESORTCOOKIE",r,{expires:1,path:"/"});break;case 7:n.cookie("LIBUSERSETJOURNALSORTCOOKIE",r,{expires:1,path:"/"})}if(f=n("#searchType").val(),f=="normal")n.when(search(u)).done(function(){n("a[data-key="+r+"]").addClass("active").siblings().removeClass("active");i.render()});else if(f=="advance"){var e=t.parent().parent().parent().parent().parent().parent().data("guid"),o=t.parent().parent().parent().parent().parent().parent().find("input[name=searchParamModelJson]").val(),u=JSON.parse(o);u.Sort=r;n.when(advSearch(u,e)).done(function(){n("a[data-key="+r+"]").addClass("active").siblings().removeClass("active");i.render()})}}};window.bindSelectArticle=function(){var r="";if(r=getSessionSelectArticle(),r==""){t.msg("请选择要导出的文献！");return}n.ajax({type:"post",url:"/WebControl/CheckIsOrg",dataType:"json",async:!1,success:function(u){var f=u.RetValue;f==0?n.ajax({url:"/Qikan/WebControl/Batch",type:"post",dataType:"html",success:function(r){n("#batch").html(r);i.render();t.open({type:1,skin:"layui-layer-rim",title:"批量处理 ",id:"downBatch",area:["950px","600px"],anim:0,resize:!1,content:n("#batch"),shadeClose:!0,zIndex:t.zIndex,success:function(n){t.setTop(n)}})},error:function(){}}):selectArticle(r)}})};window.selectArticle=function(r){n.ajax({url:"/Qikan/WebControl/SelectArticle",type:"post",dataType:"html",data:{ids:r},success:function(r){n("#selection").html(r);i.render();t.open({type:1,skin:"layui-layer-rim",title:" ",area:["650px","365px"],id:"downBatch",anim:0,resize:!1,content:n("#selection"),shadeClose:!0,zIndex:t.zIndex,success:function(n){t.setTop(n)}})},error:function(){}})};n(document).off("click",".indexArticleIconView").on("click",".indexArticleIconView",function(){var r=n(this).attr("data-pagurl"),u=n(this).attr("data-pagurl2"),i;if(r==""){t.msg("暂无预览");return}i=new Image;i.onerror=function(){var n=r;i.width=970;i.height=1388;i.src=u;i.onerror=null};i.src=r;n("#showImage").append(i);t.open({title:"在线预览",type:1,content:n("#showImage"),shadeClose:!0,scrollbar:!1,offset:["15px"],area:["990px","750px"],end:function(){n("#showImage").empty()}})});i.on("select(advIdentifierChange)",function(n){n.value=="C"?(n.othis.parent().next().children(".tycbtn").hide(),n.othis.parent().next().children(".classbtn").show(),n.othis.parent().next().hasClass("has-inline-button")||n.othis.parent().next().addClass("has-inline-button")):n.value=="M"||n.value=="T"||n.value=="K"||n.value=="R"?(n.othis.parent().next().children(".classbtn").hide(),n.othis.parent().next().children(".tycbtn").show(),n.othis.parent().next().hasClass("has-inline-button")||n.othis.parent().next().addClass("has-inline-button")):(n.othis.parent().next().children(".classbtn").hide(),n.othis.parent().next().children(".tycbtn").hide(),n.othis.parent().next().hasClass("has-inline-button")&&n.othis.parent().next().removeClass("has-inline-button"))});n(document).off("click",".classbtn").on("click",".classbtn",function(){var r=n(this).prev();r.addClass("selecting");n("#category").find("input[type=checkbox]:checked").each(function(){n(this).prop("checked",!1)});i.render();t.open({type:1,title:"选择分类号",area:["720px","480px"],content:n("#category"),shadeClose:!0,success:function(){},cancel:function(i){n("#category").hide();r.removeClass("selecting");t.close(i)}})});n(document).off("click",".tycbtn").on("click",".tycbtn",function(){var r=n(this).prev().prev();if(r.addClass("selecting"),r.val()==""){t.msg("请输入检索词！");return}n.ajax({url:"/WebControl/SelectSynonymWords",type:"post",dataType:"html",data:{keyword:r.val()},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(r){n("#synonymwords").html(r);t.tab({area:["650px","400px"],skin:"layui-layer-tab thesaurus-box",tab:[{title:"同义词扩展",content:n("#thesaurus").html()},{title:'<i class="layui-icon layui-icon-form"><\/i>同义词反馈',content:n("#thesaurus-feedback").html()}],success:function(){n("#synonymwords").html("");i.render()}});i.render()},error:function(){}})});i.on("checkbox(chkThesaurusSynonymWordAll)",function(t){n("input[name=chkThesaurusSynonymWords]").each(function(n,i){i.value!=t.elem.dataset.keyword&&(i.checked=t.elem.checked)});i.render("checkbox")});i.on("checkbox(chkThesaurusSynonymWord)",function(){var t=!0;n("input[name=chkThesaurusSynonymWords]").each(function(){if(n(this).prop("checked")==!1)return t=!1,!1});n("input[name=chkall]").prop("checked",t);i.render("checkbox")});i.on("submit(submitThesaurus)",function(){var i="",e,r,u,o,s,f;for(n("input[name=chkThesaurusSynonymWords]").each(function(){n(this).prop("checked")==!0&&(i=i==""?n(this).val():i+"+"+n(this).val())}),e=n.trim(n("#txtThesaurusSynonymWords").val()),e!=""&&(i=i==""?e.replace(/；/g,"+").replace(/;/g,"+"):i+"+"+e.replace(/；/g,"+").replace(/;/g,"+")),r=n.trim(n(".advance .selecting").val()),i.indexOf("+")>=0&&i.indexOf("+"+r+"+")<0&&i.indexOf("+"+r)<0&&i.indexOf(r+"+")<0?i=r+"+"+i:i!=""&&i.indexOf("+")<0&&i.replace(/(^\s*)|(\s*$)/g,"")!=r.replace(/(^\s*)|(\s*$)/g,"")?i=r+"+"+i:i==""&&(i=r),u=[],u=i.split("+"),o=[],s=!1,f=0;f<u.length;f++)if(n.inArray(u[f].toString(),o)>=0){t.alert("同义词["+u[f].toString()+"]有重复内容！",{icon:2,closeBtn:0},function(n){t.close(n)});s=!0;break}else o.push(u[f].toString());s!=!0&&(n(".advance .selecting").val(i).removeClass("selecting"),t.closeAll())});i.on("submit(submitThesaurusFeedback)",function(){var i="",s=!1,o,r,u,h,c,f,l,e;if(n("input[name=chkThesaurusFeedbackSynonymWords]").each(function(){n(this).prop("checked")==!1?i=i==""?n(this).val():i+"+"+n(this).val():s=!0}),o=n.trim(n("#txtThesaurusFeedbackSynonymWords").val()),o!=""&&(i=i==""?o.replace(/；/g,"+").replace(/;/g,"+"):i+"+"+o.replace(/；/g,"+").replace(/;/g,"+"),s=!0),r=n.trim(n(".advance .selecting").val()),i.indexOf("+")>=0&&i.indexOf("+"+r+"+")<0&&i.indexOf("+"+r)<0&&i.indexOf(r+"+")<0?i=r+"+"+i:i!=""&&i.indexOf("+")<0&&i.replace(/(^\s*)|(\s*$)/g,"")!=r.replace(/(^\s*)|(\s*$)/g,"")&&(i=r+"+"+i),i.indexOf("+")<0){t.alert("反馈内容不能少于两个词！",{icon:2,closeBtn:0},function(n){t.close(n)});return}for(u=[],u=i.split("+"),h=[],c=!1,f=0;f<u.length;f++)if(n.inArray(u[f].toString(),h)>=0){t.alert("同义词["+u[f].toString()+"]有重复内容！",{icon:2,closeBtn:0},function(n){t.close(n)});c=!0;break}else h.push(u[f].toString());if(c!=!0){if(l=n("#hidCurrentSynonymWords").val(),l!=""&&i!=""){var v=!0,a=l.split("+").sort(),y=i.split("+").sort();if(a.length==y.length){for(e=0;e<a.length;e++)if(a[e].replace(/(^\s*)|(\s*$)/g,"")!=y[e].replace(/(^\s*)|(\s*$)/g,"")){v=!1;break}if(v){t.alert("反馈内容与原同义词组相同！",{icon:2,closeBtn:0},function(n){t.close(n)});return}}}i!=""&&s?n.ajax({type:"post",url:"/WebControl/SynonymWordsFeedback",data:{synonymWordsId:n("#hidSynonymWordsId").val(),synonymwords:i},dataType:"json",async:!1,success:function(n){n.Result==1?t.alert("反馈成功！",{icon:1,closeBtn:0},function(){t.closeAll()}):t.alert("反馈失败！",{icon:2,closeBtn:0},function(){t.closeAll()})},complete:function(){},error:function(){t.alert("反馈失败！",{icon:2,closeBtn:0},function(){t.closeAll()})}}):t.alert("请添加反馈内容！",{icon:0,closeBtn:0},function(n){t.close(n)})}});n(document).off("click","#category .class-box .cluster-list .icon-plus,#category .class-box .cluster-list .icon-minus").on("click","#category .class-box .cluster-list .icon-plus,#category .class-box .cluster-list .icon-minus",function(){var t=n(this),r=t.parent().parent().children("ul"),u;r.length?t.hasClass("icon-plus")?(r.show(),t.removeClass("icon-plus").addClass("icon-minus")):(r.hide(),t.removeClass("icon-minus").addClass("icon-plus")):(t.removeClass("icon-plus").addClass("icon-loading"),u=t.next().prop("checked"),n.ajax({url:"/WebControl/SelectExtendClassNo",type:"post",dataType:"html",data:{pid:n(this).parent().data("lngid"),chkStatus:u},success:function(n){t.removeClass("icon-loading").addClass("icon-minus");t.parent().parent().append(n);i.render()},error:function(){}}))});i.on("checkbox(chkClassNo)",function(t){var r=[],o=n("#hidSelectedClassNo").val(),u,f,e,s;o!=""&&(r=o.split("+"));u=n(this).prop("checked");f=t.othis.parent().parent().children("ul");f.length&&f.find("input").each(function(){n(this).prop("checked",u)});u?(e=!1,s=n(this).parent().parent(),s.parents("li").each(function(){if(n(this).children("span").children("input").prop("checked"))return e=!0,!1}),e||n.inArray(t.elem.value.toString(),r)<0&&r.push(t.elem.value.toString())):(t.othis.parents("li").each(function(){n(this).children("span").children("input").prop("checked",u)}),n.inArray(t.elem.value.toString(),r)>=0&&r.splice(n.inArray(t.elem.value.toString(),r),1));n("#hidSelectedClassNo").val(r.join("+"));i.render()});n(document).off("click","#category .submit .layui-btn").on("click","#category .submit .layui-btn",function(){n(this).hasClass("layui-btn-primary")?(n(".advance .selecting").removeClass("selecting"),n("#category").hide(),t.closeAll()):(n(".advance .selecting").val(n("#hidSelectedClassNo").val()).removeClass("selecting"),n("#hidSelectedClassNo").val(""),t.closeAll())});n(document).off("click",".collectarticle").on("click",".collectarticle",function(){if(isLoginFlowUser())if(n(this).children("i").hasClass("icon-favorite-o"))t.msg("已经收藏过了！");else{var i=n(this).data("articleid")+",123";window.checkNormallogin(f,[i])}else n(".user-more").data("isorg")==1?(t.closeAll(),t.alert("机构账号暂不支持收藏",function(){t.closeAll()})):loginAction()});n(document).off("click",".attentionobjects").on("click",".attentionobjects",function(){if(isLoginFlowUser())if(n(this).children("i").hasClass("icon-favorite-o"))t.msg("已经关注过了！");else{var i=n(this).data("journalid")+","+n(this).data("lastnum");window.checkNormallogin(e,[i])}else n(".user-more").data("isorg")==1?(t.closeAll(),t.alert("机构账号暂不支持关注",function(){t.closeAll()})):loginAction()});n(document).off("click","#btnVerifySubmit").on("click","#btnVerifySubmit",function(){var i,r;if(n("#txtPdfTitle").val()=="")return alert("请输入验证码！"),!1;if(i=checkUserOperate(),setCookie("search_isEnable",i),i==2){alert("验证码输入错误！");n("#btnVerifyCode").trigger("click");n("#txtPdfTitle").val("");n("#txtPdfTitle").focus();return}t.close(t.index);r=n("#hid_searchtype").val();switch(r){case"search":basicSearch();break;case"searchList":searchList(n("#hidRequestsearchParamModel").val());break;case"RetrievalSearchExpression":n("#basic_searchdomainfilter .advance-submit .adv-search").click();break;case"RetrievalBasicExpression":n("#re_searchdomainfilter .advance-submit .adv-search").click();break;default:basicSearch()}});n(document).off("click","#btnVerifyCode").on("click","#btnVerifyCode",function(){n("#valiCode").attr("src","/RegistLogin/AuthCode?key=requestLimit&time="+(new Date).getTime())});n(document).off("keyup","#searchKeywords").on("keyup","#searchKeywords",function(i){var u=window.event||i,f=u.keyCode||u.which,r;if(f==13){if(n("#hid_searchtype").val("search"),r=checkUserOperate(),setCookie("search_isEnable",r),r==0){n("#valiCode").attr("src","/RegistLogin/AuthCode?key=requestLimit&time="+(new Date).getTime());t.open({type:1,closeBtn:0,title:"检索验证",area:["600px","300px"],content:n("#checkcode"),shadeClose:!0,success:function(){n("#txtPdfTitle").val("");n("#txtPdfTitle").focus()}});return}basicSearch()}});window.basicSearch=function(){var u,f;n("#btnSearch").parent().addClass("searching");var r="",t=n("select[name='identifier']").val(),i=n("input[name='searchKeywords']").val();i!=""&&(t==""&&(t="U"),r=t+"="+i);u=1;f=1;clickBehavior(BtnObject.Search.Id,BtnObject.Search.BoardName);n.StandardPost("/Qikan/Search/Index",{key:encodeURIComponent(r),isNoteHistory:u,isLog:f,indexKey:i,indexIdentifier:t})};window.checkUserOperate=function(){var t=1;return n.ajax({type:"post",url:"/CheckRequest/IsVerificationPass",data:{verificationCode:n("#txtPdfTitle").val()},dataType:"json",async:!1,success:function(n){t=n.RetValue.IsPass},complete:function(){},error:function(){}}),t};window.setCookie=function(t,i){getCookie(t)!=i&&n.cookie(t,i,{path:"/",expires:1})};window.getCookie=function(t){var i=n.cookie(t);return i!=null?i:""};window.getSessionSelectArticle=function(){var t="",i=getCookie("select_article");return i!="onserver"&&i!=""?t=LZString.decompressFromEncodedURIComponent(i):i=="onserver"&&n.ajax({type:"post",url:"/WebControl/GetSelectArticle",data:{},dataType:"json",async:!1,success:function(n){n.Result==1?t=n.RetValue:(t="",console.log(n.PromptMsg))},complete:function(){},error:function(){}}),t};window.setSessionSelectArticle=function(t){var i,f,r,u;t!=""&&(i=t.split(","),i.length>500&&(f=i.slice(0,499),t=f.join(",")));r="select_article";u=LZString.compressToEncodedURIComponent(t);u.length<3500?setCookie(r,u):n.ajax({type:"post",url:"/WebControl/SetSelectArticle",data:{ids:t},dataType:"json",async:!1,success:function(n){n.Result==1&&(setCookie(r,"onserver"),console.log("set ok"))},complete:function(){},error:function(){}})};n(document).off("click",".search-history .orderread").on("click",".search-history .orderread",function(){var i=n(this).data("lngmysearhistoryguid"),r=n(this).data("showrules");n.ajax({url:"/WebControl/CheckUserType",type:"post",dataType:"json",data:{},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(u){u.RetValue==0?t.confirm(u.PromptMsg,{icon:3,title:"提示"},function(n){loginAction();t.close(n)}):u.RetValue==2?(n("#hidOrgMkey").val(u.Tag),t.confirm(u.PromptMsg,{icon:3,title:"提示"},function(n){loginAction();t.close(n)})):addOrderRead(i,r)},error:function(){loaddingClose()}})});n(document).off("click",".btnSearchhistory").on("click",".btnSearchhistory",function(){window.checklogin(seeSearchhistoryAfterLogin)});window.seeSearchhistoryAfterLogin=function(){window.open("/Qikan/Article/History","_blank")};n("#rl-box").hide();n(document).off("click",".rt-op a").on("click",".rt-op a",function(){n.post("/Qikan/AuthUser/GetUserAuthState",{},function(i){i.AuthStatus==1&&n("#rl-box a").attr("href",i.redirectUrl);t.open({type:1,skin:"rl-layer",title:!1,area:["385px","232px"],anim:0,shadeClose:!0,resize:!1,content:n("#rl-box"),success:function(){}})})});n(document).off("click",".btnAuthor").on("click",".btnAuthor",function(){n.post("/Qikan/AuthUser/GetUserAuthState",{},function(i){i.AuthStatus==1&&n("#rl-box a").attr("href",i.redirectUrl);t.open({type:1,skin:"rl-layer",title:!1,area:["395px","242px"],anim:0,resize:!1,shadeClose:!0,content:n("#rl-box"),success:function(){}})})});n(document).off("click","#rl-box a").on("click","#rl-box a",function(){return isLoginFlowUser()?!0:(n(".user-more").data("isorg")==1?(t.closeAll(),t.alert("系统检测您当前为机构账号  请退出并重新注册/登录个人账号进行作品认领",function(){t.closeAll()})):loginAction(),!1)});window.quote=function(n){t.open({type:2,skin:"layui-layer-rim",title:"文献格式引用",area:["900px","320px"],anim:0,resize:!1,content:"/Qikan/Article/ExportTilte?id="+n,zIndex:t.zIndex,success:function(n){t.setTop(n)}})};i.render()});