layui.use(["form","layer","jquery","cookie"],function(){var i=layui.form,t=layui.layer,n=layui.jquery,r=layui.cookie;n(document).off("click","#discoverArticle").on("click","#discoverArticle",function(){if(isLoginFlowUser()){var t=n("#discoverArticle").data("articleid");discoverArticle(t)}else loginAction()});n(document).off("click","#discoverArticleRight").on("click","#discoverArticleRight",function(){isLoginFlowUser()?openDiscoveredArticles(""):loginAction()});n(document).off("click",".selection-list>dl>dd>a>i").on("click",".selection-list>dl>dd>a>i",function(){if(n(this).hasClass("icon-del")){var t=n(this).parent().data("id");delDiscoveredArticle(t,n(this))}});n(document).off("click",".academic .layui-tab .layui-tab-content .layui-tab-item>table>tbody>tr>td>a>i").on("click",".academic .layui-tab .layui-tab-content .layui-tab-item>table>tbody>tr>td>a>i",function(){if(n(this).hasClass("icon-del")){var t=n(this).parent().data("id");delDiscoveredArticle(t,null)}});n(document).off("click",".academic .web-nav>a").on("click",".academic .web-nav>a",function(){if(!isLoginFlowUser())return loginAction(),!1});n(document).off("click",".side-part .layui-btn-primary").on("click",".side-part .layui-btn-primary",function(){n.StandardPost("/Qikan/Search/Index",{key:encodeURIComponent(""),isNoteHistory:1,isLog:1,indexKey:"",indexIdentifier:"U"})});i.on("checkbox(selectDiscoveredArticle)",function(){n("input[name='discoveredArticle']").prop("checked",!1);n(this).prop("checked",!0);i.render("checkbox")});n(document).off("click","#discoverArticleSubmit").on("click","#discoverArticleSubmit",function(){var r=n("input[name=discoveredArticle]:checked").val(),i;if(r==undefined||r==null||r=="")return t.alert("请选择要提交的文献"),!1;if(i=n("input[name=clueType]:checked").val(),i==undefined||i==null||i=="")return t.alert("请选择线索类型"),!1;setDiscoveredArticle(r,i)});n(document).off("click","#submitUserInfo").on("click","#submitUserInfo",function(){var u=n("#relName").val(),i,f,r;if(u=="")return t.alert("请输入姓名",{icon:2},function(i){n("#relName").focus();t.close(i)}),!1;if(i=n("#contactInformation").val(),i=="")return t.alert("请输入联系方式",{icon:2},function(i){n("#contactInformation").focus();t.close(i)}),!1;if(f=/^[1][3,4,5,6,7,8,9][0-9]{9}$/,!f.test(i))return t.alert("手机号码格式错误",{icon:2},function(i){n("#contactInformation").focus();t.close(i)}),!1;if(r=n("#organ").val(),r=="")return t.alert("请输入高校单位",{icon:2},function(i){n("#organ").focus();t.close(i)}),!1;var e=n("#workID").val(),o=n("#hidId").val(),s=n("#hidClueType").val(),h=n("#hidOldId").val();n.ajax({type:"post",url:"/Qikan/Activity/AddUserAndReadActiveInfo",dataType:"json","async":!1,data:{contactInformation:i,organ:r,relName:u,workID:e,parmId:o,parmclueType:s,parmOldId:h},beforeSend:function(){loadding()},complete:function(){},success:function(n){loaddingClose();n.result?t.alert(n.msg,{icon:1},function(n){t.close(n);location.href="/Qikan/Activity/MyActivityInfo"}):t.alert(n.msg)},error:function(){}})});window.setDiscoveredArticle=function(i,r){n.ajax({type:"post",url:"/Qikan/Activity/IsExistClueType",dataType:"json","async":!1,data:{clueType:r},beforeSend:function(){loadding()},complete:function(){},success:function(n){if(loaddingClose(),n.result){var u=n.id;t.confirm("该项题目线索已提交  是否覆盖？",{icon:3,title:"提示"},function(){setClueType(i,r,u)})}else setClueType(i,r,0)},error:function(){}})};window.setClueType=function(i,r,u){n.ajax({type:"post",url:"/Qikan/Activity/IsExistUserInfo",dataType:"json","async":!1,data:{},beforeSend:function(){loadding()},complete:function(){},success:function(f){loaddingClose();f.result?n.ajax({type:"post",url:"/Qikan/Activity/SetClueType",dataType:"json","async":!1,data:{id:i,clueType:r,oldId:u},beforeSend:function(){loadding()},complete:function(){},success:function(n){loaddingClose();n.result?t.alert(n.msg,{icon:1,closeBtn:0},function(){t.closeAll()}):t.alert(n.msg)},error:function(){}}):n.StandardPost("/qikan/Activity/PerfectUserInfo",{id:i,clueType:r,oldId:u})},error:function(){}})};window.delDiscoveredArticle=function(i,r){t.confirm("确定删除吗？",{icon:3,title:"提示"},function(u){n.ajax({type:"post",url:"/Qikan/Activity/DelReadActive",dataType:"json","async":!1,data:{id:i},success:function(i){t.close(u);t.alert(i.msg);i.result&&(r!=null&&r!=undefined&&r!=""?n(r).parents("dl").remove():r==null&&(location.href=location.href))},error:function(){}})})};window.openDiscoveredArticles=function(r){n.ajax({type:"post",url:"/Qikan/Activity/DiscoveredArticles",dataType:"html","async":!1,data:{articleId:r},beforeSend:function(){loadding()},complete:function(){},success:function(r){loaddingClose();n("#book-selection").html(r);i.render();t.open({type:1,skin:"dsy-layer",title:" ",area:["650px","450px"],anim:0,resize:!1,shadeClose:!0,content:n("#book-selection"),success:function(){n(document).on("click",".author .more.hide",function(){n(this).hide();n(this).siblings("span").show()})}})},error:function(){}})};window.discoverArticle=function(i){n.ajax({type:"post",url:"/Qikan/Activity/AddReadActive",dataType:"json","async":!1,data:{articleId:i},beforeSend:function(){loadding()},complete:function(){},success:function(n){loaddingClose();n.result?openDiscoveredArticles(i):t.alert(n.msg)},error:function(){}})};i.render()});