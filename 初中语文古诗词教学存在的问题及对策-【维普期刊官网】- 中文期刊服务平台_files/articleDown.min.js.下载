function showdown(n,t){var i=n+","+t;window.checklogin(showDownAfterLogin,[i])}function showpaydown(n,t){var i=n+","+t;window.checkFlowUserLogin(showDownAfterFlowUserLoginLogin,[i])}function showNoOrder(){layer.alert("您所在的机构未续订或已过期，建议续订请联系机构管理员")}function showDownAfterFlowUserLoginLogin(n){var t=n.split(",")[0],i=n.split(",")[1];$.post("/Qikan/Article/GetFlowUserArticleRight",{articleId:t},function(n){var r=n.RetValue,u;r.ShowFreeOa||r.ShowDown&&r.bJurisdiction?getdowninfo(t,i):r.ShowOa?window.open(u,r.oaUrl):r.ShowDown&&!r.bJurisdiction?(u="/Qikan/UserPay/CheckOrder?id="+t+"&kind=1&tag=1",window.open(u,"_blank")):layer.alert("因版权问题，该文章暂无法提供全文")})}function showDownAfterLogin(n){var t=n.split(",")[0],i=n.split(",")[1];$.post("/Qikan/Article/GetArticleRight",{articleId:t},function(n){var u=n.RetValue,r;u?getdowninfo(t,i):n.Tag==0?(r="/Qikan/UserPay/CheckOrder?id="+t+"&kind=1",window.open(r,"_blank")):n.Tag==1&&layer.alert("包库权限不足")})}function getdowninfo(n,t){$.ajax({url:"/Qikan/Article/ArticleDown",type:"post","async":!0,data:{id:n,info:t,ts:(new Date).getTime()},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(i){i.url!="undefined"&&i.url!=null&&i.url!=""&&i.url?window.location.href=i.url:$.ajax({url:"/Qikan/Article/ArticleDown",type:"post","async":!0,data:{id:n,info:t,ts:(new Date).getTime()},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(n){n.url!="undefined"&&n.url!=null&&n.url!=""&&n.url?window.location.href=n.url:layer.alert("请重新进入并刷新文章页，再次点击下载")},error:function(){}})},error:function(){}})}function netUrl(n,t,i){$.ajax({type:"post",url:"/Qikan/Article/ShowOutChainDown",data:{id:i},success:function(){}});window.open(n,"_blank")}function showOnLineRead(n,t){var i=n+","+t;window.checklogin(showOnLineReadAfterLogin,[i])}function showOnLineReadAfterLogin(n){var t=n.split(",")[0],i=n.split(",")[1];$.ajax({url:"/Qikan/Article/GetArticleRight",type:"post","async":!1,data:{articleId:t},success:function(n){var u=n.RetValue,r;u?getOnLineRead(t,i):n.Tag==0?(r="/Qikan/UserPay/CheckOrder?id="+t+"&kind=4",window.open(r,"_blank")):n.Tag==1&&layer.alert("包库权限不足")}})}function getOnLineRead(n,t){var i="/Qikan/Article/ReadIndex?id="+n+"&info="+t;window.open(i,"_blank")}function showXmlOnLineRead(n,t){var i=n+","+t;window.checklogin(showXmlOnLineReadAfterLogin,[i])}function showXmlOnLineReadAfterLogin(n){var t=n.split(",")[0],i=n.split(",")[1];$.ajax({url:"/Qikan/Article/GetArticleRight",type:"post","async":!1,data:{articleId:t},success:function(n){var u=n.RetValue,r,i;u?(r=$("#hidPageId").val(),r==8?window.location.href="#original-content":(i="/Qikan/Article/Detail?id="+t+"#original-content",window.open(i,"_blank"))):n.Tag==0?(i="/Qikan/UserPay/CheckOrder?id="+t+"&kind=5",window.open(i,"_blank")):n.Tag==1&&layer.alert("包库权限不足")}})}function getXmlOnLineRead(n){$.ajax({url:"/Qikan/Article/GetXmlRead",type:"post","async":!1,data:{id:n},success:function(n){var r="",i,t;if(n.RetValue.xmltype=="jats")for(i=String2XML(formatLatex(n.RetValue.xmlContent)).getElementsByTagName("body")[0],t=0;t<i.childNodes.length;t++)i.childNodes[t].nodeType==1&&(r=getBodyHtmlByjats(i.childNodes[t],n.RetValue.xmlPath));$("#original").append(r)}})}function getBodyHtmlByjats(n,t){var r=$(n),f=r.context.nodeName,e,i,u;if(f=="p")bodySingelHtml+=xml2String(n);else if(f=="fig"){if(r.children("alternatives").length>0){for(i=0;i<n.childNodes.length;i++)if(n.childNodes[i].tagName=="alternatives")for(u=0;u<n.childNodes[i].childNodes.length;u++)if(n.childNodes[i].childNodes[u].tagName=="graphic"&&$(n.childNodes[i].childNodes[u]).attr("specific-use")=="big"){e=t+$(n.childNodes[i].childNodes[u]).attr("xlink:href");bodySingelHtml+="<div class='graphic'><img src='"+e+"'><\/img>";break}}else e=t+r.children("graphic").attr("xlink:href"),bodySingelHtml+="<div class='graphic'><img src='"+e+"'><\/img>";for(bodySingelHtml+="<div class='fig_caption_lable'>"+r.children("label").text()+"<span class='fig_caption'>"+r.children("caption").children("title").text(),i=0;i<n.childNodes.length;i++)(n.childNodes[i].tagName=="caption"||n.childNodes[i].tagName=="abstract")&&(bodySingelHtml+=xml2String(n.childNodes[i]));bodySingelHtml+="<\/span><\/div>";bodySingelHtml+="<div class='abstract_alt_text'>"+r.children("alt-text").text()+"<span class='abstract'>"+r.children("abstract").children("title").text()+"<\/span><\/div><\/div>"}else if(f=="table-wrap"){for(bodySingelHtml+="<div class='table'><div class='table_caption_lable'>"+r.children("label").text()+"<span class='table_caption'>"+r.children("caption").children("p").text()+"<\/span><\/div>",bodySingelHtml+="<div class='table_abstract_alt_text'>"+r.children("alt-text").text()+"<span class='table_abstract'>"+r.children("abstract").children("p").text()+"<\/span><\/div>",i=0;i<n.childNodes.length;i++)if(n.childNodes[i].tagName=="table"&&(bodySingelHtml+=xml2String(n.childNodes[i])),n.childNodes[i].tagName=="alternatives")for(u=0;u<n.childNodes[i].childNodes.length;u++)n.childNodes[i].childNodes[u].tagName=="table"&&(bodySingelHtml+=xml2String(n.childNodes[i].childNodes[u]));bodySingelHtml+="<div class='table_wrap_foot'><table>"+r.children("table-wrap-foot").children("fn").children("p").text()+"<\/table><\/div><\/div>"}else f=="sec"?((r.children("label").text()!=""||r.children("title").text()!="")&&(bodySingelHtml+="<h2 class='title_"+r.attr("id")+"'><span class='sec_label'>"+r.children("label").text()+"<\/span><span class='sec_title'>"+r.children("title").text()+"<\/span><\/h2>"),r.children().each(function(){getBodyHtmlByjats(this,t)})):f=="title"||f=="label"||(bodySingelHtml+=f=="disp-formula"?"<div class='formula'>"+xml2String(n)+"<\/div>":formatLatex(xml2String(n)));return bodySingelHtml}function String2XML(n){var i,t;return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(n),t):(i=new DOMParser,t=i.parseFromString(n,"text/xml"),t)}function xml2String(n){return(new XMLSerializer).serializeToString(n)}function formatLatex(n){return n.replace(/\\begin{document} /g,"$").replace(/\\begin{document}/g,"$").replace(/ \\end{document}/g,"$").replace(/\\end{document}/g,"$")}var bodySingelHtml="";